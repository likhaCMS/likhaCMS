var ge=Object.defineProperty,ye=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var X=(e,s,r)=>s in e?ge(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r,I=(e,s)=>{for(var r in s||(s={}))be.call(s,r)&&X(e,r,s[r]);if(W)for(var r of W(s))he.call(s,r)&&X(e,r,s[r]);return e},Y=(e,s)=>ye(e,_e(s));import{br as ie,bs as ke,bt as xe,U as H,ad as de,bu as Ce,aa as ue,bF as we,bv as Se,l as h,r as Be,aZ as F,ap as Ve,ao as Qe,at as qe,am as Le,az as m,V as b,b2 as l,a3 as a,Y as c,bL as J,bw as L,X as Z,aF as ee,b4 as B,bB as te,B as N,a2 as z,F as x,cF as ae,bx as V,bo as oe,y as Q,J as le,cy as Me,cG as se,cH as $e,W as ze,cl as De,aC as Ie,aA as Ne}from"./index.5fc0fc72.js";import{a as U,b as M,e as $}from"./QSelect.5ebe50cd.js";import{Q as R}from"./QSpace.d16c0fd4.js";import{b as He,d as Oe,a as Te,c as Ae}from"./QPage.b9ec7a82.js";import{a as Pe}from"./QToolbar.288b5edc.js";import{C as ne}from"./ClosePopup.58af9f54.js";import{u as re}from"./use-dialog-plugin-component.25a5fb61.js";import"./QTabs.20bad87c.js";var E=ie({name:"QList",props:Y(I({},ke),{bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean}),setup(e,{slots:s}){const r=ue(),p=xe(e,r.proxy.$q),C=H(()=>"q-list"+(e.bordered===!0?" q-list--bordered":"")+(e.dense===!0?" q-list--dense":"")+(e.separator===!0?" q-list--separator":"")+(p.value===!0?" q-list--dark":"")+(e.padding===!0?" q-list--padding":""));return()=>de("div",{class:C.value},Ce(s.default))}});const Fe=["top","middle","bottom"];var Je=ie({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>Fe.includes(e)}},setup(e,{slots:s}){const r=H(()=>e.align!==void 0?{verticalAlign:e.align}:null),p=H(()=>{const C=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(C!==void 0?` text-${C}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>de("div",{class:p.value,style:r.value,role:"alert","aria-label":e.label},we(s.default,e.label!==void 0?[e.label]:[]))}});const Ue=e=>(Ie("data-v-30ae4836"),e=e(),Ne(),e),Re={class:"shadow-24 bg-dark column",style:{width:"300px","z-index":"5 !important"}},Ee={class:"col"},je=z("TB"),Ge=Ue(()=>c("div",{class:"text-h6"},"Staging Deployment",-1)),Ke={class:"col column text-white"},We={class:"shadow-10 row",style:{"z-index":"4 !important"}},Xe=z("TB"),Ye={class:"text-blue-grey"},Ze={class:"q-pa-sm"},et={class:"row col"},tt={class:"shadow-24",style:{width:"300px","z-index":"3 !important"}},at={class:"row"},ot={class:"col"},lt={__name:"lkHistory",props:["component","codes"],emits:[...re.emits],setup(e){const s=e,{$likhaAPI:r,$monaco:p,$qs:C}=ue().appContext.config.globalProperties,O=h(null),D=h(""),w=h(!1),v=h("template"),f=h(""),g=h([]),T=h(null);let k,y,_;const S=Be({props:[],summary:"",description:""}),q=h({});F(w,n=>{k&&k.updateOptions({renderSideBySide:n})});const j=n=>{switch(n){case"template":return"html";case"style":return"css";default:return"javascript"}};F(f,n=>{if(k){const o=g.value.filter(d=>d.id===n)[0];q.value=I({},o);const t=s.codes.filter(d=>d.prop===v.value)[0],i=JSON.parse(o.codes)[v.value],u=j(v.value);if(p.editor.setModelLanguage(_,u),p.editor.setModelLanguage(y,u),t.value===i){_.setValue(""),y.setValue("");return}_.setValue(t.value),y.setValue(i)}}),F(v,n=>{if(k){const o=j(n);p.editor.setModelLanguage(_,o),p.editor.setModelLanguage(y,o);const t=g.value.filter(d=>d.id===f.value)[0],i=s.codes.filter(d=>d.prop===v.value)[0],u=JSON.parse(t.codes)[v.value];if(i.value===u){_.setValue(""),y.setValue("");return}_.setValue(i.value),y.setValue(u)}});function ce(n){console.log("version",JSON.parse(n.codes)),G(n)}function A(n){var u;const o=g.value.filter(d=>d.id===f.value)[0],t=(u=s.codes.filter(d=>d.prop===n)[0])==null?void 0:u.value,i=JSON.parse(o.codes)[n];if(i.length){if(i.length&&t.length===0)return"deleted"}else return"new";return"edited"}const P=H(()=>s.codes.filter(n=>pe(n.prop)));function pe(n){const o=g.value.filter(u=>u.id===f.value)[0];if(!o)return;const t=s.codes.filter(u=>u.prop===n)[0],i=JSON.parse(o.codes)[n];if(t.value!==i)return!0}Ve(()=>{y.dispose(),_.dispose(),k.dispose()}),Qe(async()=>{const n=C.stringify({filters:{component:s.component.id},sort:["createdAt:desc"],pagination:{start:0,limit:15}});g.value=(await r.get("/versions?"+n)).data.data.map(o=>I({id:o.id},o.attributes))}),qe(async()=>{y=p.editor.createModel("","html"),_=p.editor.createModel("","html"),console.log("trin editor",O,y,_),await Le(),setTimeout(()=>{k=p.editor.createDiffEditor(O.value,{readOnly:!0,automaticLayout:!0,scrollBeyondLastLine:!1,theme:"vs-dark",insertSpaces:!0,tabSize:2,renderSideBySide:!1}),k.setModel({original:y,modified:_})},300)});const{dialogRef:me,onDialogHide:ve,onDialogOK:G,onDialogCancel:K}=re();async function fe(){const n={},o={};for(const d of s.codes)n[d.prop+"Staging"]=d.value,o[d.prop]=d.value;await r.put("/components/"+s.component.id,{data:n});const{summary:t,description:i}=S,u={component:s.component.id,summary:t,description:i,codes:JSON.stringify(o)};await r.post("/versions",{data:u}),G(u)}return(n,o)=>(m(),b(De,{"full-width":"",persistent:"",class:"z-top",ref_key:"dialogRef",ref:me,onHide:Q(ve)},{default:l(()=>[a(Ae,{view:"hHh LpR fFf",container:"",class:"bg-white"},{default:l(()=>[a(He,null,{default:l(()=>[a(Oe,{class:"bg-dark row",style:{overflow:"hidden","max-height":"calc(100vh - 150px) !important"}},{default:l(()=>[c("div",Re,[a(J,{dark:"",dense:"",standout:"",modelValue:D.value,"onUpdate:modelValue":o[1]||(o[1]=t=>D.value=t),class:"q-mx-md q-my-sm","input-class":"text-left"},{append:l(()=>[D.value===""?(m(),b(L,{key:0,name:"search"})):(m(),b(L,{key:1,name:"clear",class:"cursor-pointer",onClick:o[0]||(o[0]=t=>D.value="")}))]),_:1},8,["modelValue"]),c("div",Ee,[a(E,{dark:"",separator:""},{default:l(()=>[(m(!0),Z(le,null,ee(g.value,t=>B((m(),b(U,{clickable:"",key:"commit"+t.id,onClick:i=>f.value=t.id,class:N({"bg-blue-grey-10":f.value===t.id}),onMouseover:i=>T.value=t.id,onMouseleave:o[2]||(o[2]=i=>T.value=null)},{default:l(()=>[a(M,null,{default:l(()=>[a($,null,{default:l(()=>[z(x(t.summary),1)]),_:2},1024),a($,{caption:""},{default:l(()=>[a(ae,{size:"24px",color:"secondary"},{default:l(()=>[je]),_:1}),c("span",{class:N({"text-blue-grey":f.value!==t.id,"text-white":f.value===t.id})}," TB \u2022 "+x(t.createdAt),3)]),_:2},1024)]),_:2},1024),a(M,{avatar:""},{default:l(()=>[B(a(V,{onClick:i=>ce(t),size:"sm",round:"",dense:"",icon:"get_app",class:"bg-blue-grey-10"},null,8,["onClick"]),[[oe,Q(P).length&&f.value===t.id&&T.value===t.id]])]),_:2},1024)]),_:2},1032,["onClick","class","onMouseover"])),[[te]])),128))]),_:1})]),B(a(Me,{class:"bg-dark text-white absolute-bottom shadow-up-1",style:{"max-width":"300px"}},{default:l(()=>[a(se,null,{default:l(()=>[Ge]),_:1}),a(se,{class:"q-pt-none"},{default:l(()=>[a(J,{dark:"",modelValue:S.summary,"onUpdate:modelValue":o[3]||(o[3]=t=>S.summary=t),type:"text",label:"Summary"},null,8,["modelValue"]),a(J,{dark:"",modelValue:S.description,"onUpdate:modelValue":o[4]||(o[4]=t=>S.description=t),type:"textarea",label:"Description",autogrow:"","input-style":"min-height: 64px;"},null,8,["modelValue"])]),_:1}),a($e,{align:"right",class:"text-primary"},{default:l(()=>[B(a(V,{flat:"",label:"Cancel",onClick:Q(K)},null,8,["onClick"]),[[ne]]),a(V,{disabled:!S.summary||!Q(P).length&&g.value.length,flat:"",label:"Commit",onClick:fe},null,8,["disabled"])]),_:1})]),_:1},512),[[oe,!g.value.length||g.value.length&&g.value[0].id===f.value]])]),c("div",Ke,[c("div",We,[a(E,{dark:"",separator:""},{default:l(()=>[q.value.summary?(m(),b(U,{key:0},{default:l(()=>[a(M,null,{default:l(()=>[a($,null,{default:l(()=>[z(x(q.value.summary),1)]),_:1}),a($,{caption:""},{default:l(()=>[a(ae,{size:"24px",color:"secondary"},{default:l(()=>[Xe]),_:1}),c("span",Ye,x(q.value.autthor)+" \u2022 "+x(q.value.createdAt),1)]),_:1})]),_:1})]),_:1})):ze("",!0)]),_:1}),a(R),c("div",Ze,[a(V,{onClick:o[5]||(o[5]=t=>w.value=!w.value),color:w.value?"blue-grey-10":"dark","text-color":w.value?"secondary":"grey",round:"",icon:w.value?"compare":"difference"},null,8,["color","text-color","icon"])])]),c("div",et,[c("div",tt,[a(E,{dense:"",dark:"",separator:""},{default:l(()=>[(m(!0),Z(le,null,ee(Q(P),t=>B((m(),b(U,{key:t.prop,clickable:"",class:N({"bg-blue-grey-10 text-white":v.value===t.prop}),onClick:i=>v.value=t.prop},{default:l(()=>[a(M,null,{default:l(()=>[a($,{caption:"",class:N({"text-white":v.value===t.prop,"text-blue-grey":v.value!==t.prop})},{default:l(()=>[z(x(t.prop)+" "+x(A(t.prop)),1)]),_:2},1032,["class"])]),_:2},1024),a(M,{avatar:""},{default:l(()=>[c("div",at,[A(t.prop)==="edited"?(m(),b(L,{key:0,size:"18px",color:"warning",name:"change_circle"})):A(t.prop)==="deleted"?(m(),b(L,{key:1,size:"18px",color:"red",name:"remove_circle_outline"})):(m(),b(L,{key:2,size:"18px",color:"positive",name:"add_circle_outline"}))])]),_:2},1024)]),_:2},1032,["class","onClick"])),[[te]])),128))]),_:1})]),c("div",ot,[c("div",{ref_key:"editor",ref:O,class:"fit"},null,512)])])])]),_:1})]),_:1}),a(Te,{elevated:"",class:"bg-primary"},{default:l(()=>[a(Pe,{class:"shadow-10"},{default:l(()=>[a(V,{flat:"",dense:"",icon:"history",label:"History"}),a(R),a(Je,{color:"secondary",flat:"",dense:"","no-caps":"",label:"<\xA0"+e.component.name+" />"},null,8,["label"]),a(R),B(a(V,{flat:"",onClick:Q(K),round:"",dense:"",icon:"close"},null,8,["onClick"]),[[ne]])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var vt=Se(lt,[["__scopeId","data-v-30ae4836"]]);export{vt as default};
